<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>بوابة الأهرامات — AlArab AI Portal</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="stars"></div>
  <div id="blue-orb" aria-hidden="true"></div>

  <div class="glyph" style="left:8%; animation-duration:26s;">𓂀</div>
  <div class="glyph" style="left:28%; animation-duration:30s;">𓃣</div>
  <div class="glyph" style="left:58%; animation-duration:22s;">𓆣</div>
  <div class="glyph" style="left:78%; animation-duration:28s;">𓉔</div>

  <div id="ground"></div>

  <div id="tours">
    <button class="tour-btn" onclick="createFlyingText('رحلة سفاري بالصحراء 🌵', false)">Safari</button>
    <button class="tour-btn" onclick="createFlyingText('ركوب الجمال 🐪', false)">Camel Ride</button>
    <button class="tour-btn" onclick="createFlyingText('دراجة رباعية الصحراء 🏍️', false)">Quad Bike</button>
    <button class="tour-btn" onclick="createFlyingText('زيارة الأهرامات 🏜️', false)">Pyramids</button>
  </div>

  <input id="chatbox" type="text" placeholder="اكتب رسالتك هنا..." autocomplete="off"/>

<script>
const stars = document.getElementById("stars");
const chatbox = document.getElementById("chatbox");
let activeMessage = null;

function makeStars(n=110){
  for (let i = 0; i < n; i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.style.left = Math.random() * window.innerWidth + "px";
    star.style.top = Math.random() * window.innerHeight + "px";
    star.style.opacity = 0.2 + Math.random()*0.9;
    star.style.transform = `scale(${0.6 + Math.random()*1.6})`;
    star.style.animationDuration = 6 + Math.random() * 12 + "s";
    stars.appendChild(star);
  }
}
makeStars(110);

function createFlyingText(text, isAI = false){
  const centerX = window.innerWidth/2;
  const centerY = window.innerHeight/2 - 20;

  if(activeMessage){
    [...activeMessage.children].forEach(span => {
      const randX = (Math.random() - 0.5) * window.innerWidth;
      const randY = (Math.random() - 0.5) * window.innerHeight;
      span.style.setProperty("--x", randX + "px");
      span.style.setProperty("--y", randY + "px");
      span.style.animation = "flyOut 1.8s forwards";
      setTimeout(()=>{
        span.style.animation = `orbit ${8 + Math.random()*12}s linear infinite`;
        span.style.pointerEvents = "auto";
        span.addEventListener("click", ()=> flashEffect(span));
      }, 1800);
    });
    activeMessage = null;
  }

  const group = document.createElement("div");
  group.style.position = "absolute";
  group.style.left = 0; group.style.top = 0;

  const chars = Array.from(text);
  const fontSize = Math.max(28, Math.floor(Math.min(window.innerWidth, window.innerHeight)/18));

  chars.forEach((ch, i) => {
    const span = document.createElement("span");
    span.className = "letter";
    span.textContent = ch;
    if(isAI) span.classList.add("ai-letter");

    const randX = (Math.random() - 0.5) * window.innerWidth;
    const randY = (Math.random() - 0.5) * window.innerHeight;
    span.style.setProperty("--x", randX + "px");
    span.style.setProperty("--y", randY + "px");

    span.style.left = (centerX - (chars.length * (fontSize*0.28)) /2 + i*(fontSize*0.28)) + "px";
    span.style.top = centerY + "px";
    span.style.fontSize = fontSize + "px";

    group.appendChild(span);
  });

  stars.appendChild(group);
  activeMessage = group;
}

function flashEffect(span){
  span.classList.add("flash");
  setTimeout(()=>span.classList.remove("flash"), 700);
}

async function sendToServer(message){
  try{
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ message })
    });
    const j = await res.json();
    return j.reply;
  }catch(e){
    console.error(e);
    return "تعذر الاتصال بالخادم.";
  }
}

chatbox.addEventListener('keydown', async (e)=>{
  if(e.key === 'Enter' && chatbox.value.trim() !== ""){
    const txt = chatbox.value.trim();
    createFlyingText(txt, false);
    chatbox.value = "";
    const reply = await sendToServer(txt);
    if(reply) createFlyingText(reply, true);
  }
});

const seeds = ['مغامرة','جمل','حصان','نلتقي','777','بوابة'];
seeds.forEach((w,i)=> setTimeout(()=> spawnFloating(w), 800 + i*400));

function spawnFloating(text){
  const el = document.createElement('div');
  el.className = 'floating-word';
  el.textContent = text;
  el.style.left = (Math.random()* (window.innerWidth*0.7) + window.innerWidth*0.15) + 'px';
  el.style.top = (Math.random()* window.innerHeight*0.22 + window.innerHeight*0.06) + 'px';
  el.onclick = ()=> { el.remove(); createFlyingText(text, false); };
  document.body.appendChild(el);
  setTimeout(()=> el.remove(), 7000);
}

window.addEventListener('resize', ()=>{
  document.querySelectorAll('.star').forEach(s=>s.remove());
  makeStars(110);
});
</script>
</body>
</html>
