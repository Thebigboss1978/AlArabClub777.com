<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AlArab 777 | غرفة المتابعة + سوق الوكلاء</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --c1:#00ffff; --c2:#ff00ff; --c3:#0af; --bg:#070b12; --panel:#0f1624;
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, rgba(255,0,255,.14), transparent 40%), radial-gradient(900px 500px at 0% 120%, rgba(0,255,255,.12), transparent 45%), var(--bg);color:#e9f8ff;font-family:"Cairo",system-ui}
  h2,h3{margin:8px 0 4px}
  .wrap{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:16px}
  .card{background:rgba(15,22,36,.9);border:1px solid rgba(0,255,255,.25);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  label{font-size:12px;opacity:.8}
  input,select,textarea{background:#0b1220;border:1px solid rgba(0,255,255,.25);color:#fff;border-radius:10px;padding:10px;font-family:inherit}
  textarea{width:100%;min-height:90px}
  button{background:linear-gradient(135deg,var(--c1),var(--c2));border:0;color:#000;font-weight:900;border-radius:10px;padding:10px 14px;cursor:pointer}
  button.ghost{background:transparent;color:#cfe; border:1px solid rgba(0,255,255,.3)}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);font-size:12px}
  .ok{color:#0f0}.bad{color:#f66}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .log{background:#060a14;border:1px dashed rgba(0,255,255,.25);border-radius:10px;padding:10px;height:220px;overflow:auto;font-size:13px;line-height:1.5}
  .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}
  .shot{border:1px solid rgba(0,255,255,.2);border-radius:10px;overflow:hidden;background:#000}
  .shot img{display:block;width:100%}
  .footer{padding:8px 16px;opacity:.6;text-align:center;font-size:12px}
  .badge{font-size:11px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);padding:4px 8px;border-radius:8px}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);margin:10px 0}
  .title{display:flex;justify-content:space-between;align-items:center}
  .title span{font-size:12px;opacity:.7}
  .market-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .item{background:#0c1322;border:1px solid rgba(0,255,255,.2);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px}
  .item h4{margin:0}
  .mini{font-size:12px;opacity:.75}
  canvas#scene{width:100%;height:240px;display:block;background:radial-gradient(circle at 50% 30%,rgba(0,255,255,.06),transparent 60%)}
  .kbd{padding:2px 6px;border:1px solid rgba(255,255,255,.2);border-radius:6px;background:rgba(255,255,255,.06);font-size:12px}
  @media (max-width:1024px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="wrap">

  <!-- غرفة المتابعة / الوكيل -->
  <section class="card">
    <div class="title">
      <h2>🛰️ غرفة المتابعة | ARA-777 Ops</h2>
      <span class="badge">Auto-Log • Auto-Screenshot</span>
    </div>

    <div class="grid2">
      <div>
        <label>اسم المهمة</label>
        <input id="taskName" placeholder="مثال: بناء سكشن هبوط لعميل السيارات">
      </div>
      <div>
        <label>الوكيل المنفّذ</label>
        <select id="agentName">
          <option>Farah-Creative</option>
          <option>Advisor-Dad</option>
          <option>Ops-Mom</option>
          <option>ARA-777 Core</option>
          <option>External-FastAgent</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:8px">
      <button id="startBtn">بدء المهمة</button>
      <button id="stopBtn" class="ghost">إيقاف</button>
      <span class="pill" id="statusPill">الحالة: جاهز</span>
      <span class="pill mono">ID: <span id="taskId">—</span></span>
      <span class="pill mono">بدأ: <span id="startedAt">—</span></span>
      <span class="pill mono">لقطات: <span id="shotCount">0</span></span>
    </div>

    <div class="hr"></div>

    <div class="grid2">
      <div>
        <h3>سجل الأحداث</h3>
        <div class="log" id="log"></div>
        <div class="row" style="margin-top:8px">
          <button id="exportLog">تصدير اللوج (JSON)</button>
          <button id="markMilestone" class="ghost">✨ علامة تقدّم</button>
        </div>
      </div>
      <div>
        <h3>المشهد الحي (Canvas)</h3>
        <canvas id="scene"></canvas>
        <div class="row" style="margin-top:8px">
          <button id="shotNow">📸 لقطة الآن</button>
          <label><input type="checkbox" id="autoShot" checked> لقطات تلقائية كل <input id="shotEvery" value="20" style="width:60px"> ثانية</label>
        </div>
      </div>
    </div>

    <h3 style="margin-top:12px">📷 المعرض</h3>
    <div class="gallery" id="gallery"></div>
  </section>

  <!-- سوق الوكلاء + المولّد -->
  <section class="card">
    <div class="title">
      <h2>🛒 سوق الوكلاء | Agent Marketplace</h2>
      <span class="badge">إدراج سريع + نص جاهز</span>
    </div>

    <div class="grid2">
      <div>
        <label>تصنيف الوكيل</label>
        <select id="cat">
          <option value="support">دعم فوري (صوت/نص)</option>
          <option value="sales">مبيعات ذكي</option>
          <option value="content">مولّد محتوى/صور</option>
          <option value="automation">أتمتة مواقع/متاجر</option>
          <option value="advisor">مستشار أعمال</option>
        </select>
      </div>
      <div>
        <label>لغة التشغيل</label>
        <select id="lang">
          <option value="ar">العربية</option>
          <option value="en">English</option>
          <option value="bi">Arabic + English</option>
        </select>
      </div>
    </div>

    <div class="grid2" style="margin-top:8px">
      <div>
        <label>اسم الوكيل</label>
        <input id="title" placeholder="مثال: Farah-Voice Concierge">
      </div>
      <div>
        <label>سعر الترخيص</label>
        <input id="price" placeholder="$/شهري أو دفع مرة واحدة">
      </div>
    </div>

    <label style="margin-top:8px">مزايا سريعة (سطر لكل ميزة)</label>
    <textarea id="features" placeholder="رد صوتي فوري\nتكامل مع WhatsApp\nتخصيص هوية صوتية"></textarea>

    <label>وصف تلقائي (يُولد هنا)</label>
    <textarea id="desc" placeholder="اضغط توليد 👇"></textarea>

    <div class="row" style="margin-top:8px">
      <button id="genCopy">توليد الكوبي</button>
      <button id="addListing" class="ghost">إدراج في السوق</button>
      <button id="exportListings" class="ghost">تصدير السوق (JSON)</button>
    </div>

    <div class="hr"></div>

    <h3>العناصر المدرجة</h3>
    <div class="market-list" id="market"></div>
  </section>

</div>

<div class="footer">▰▱▰ AlArab 777 Ops • Logging + AutoScreenshot + Marketplace ▰▱▰ | اختصار: <span class="kbd">M</span> لقطة • <span class="kbd">L</span> علامة تقدّم</div>

<!-- html2canvas لالتقاط السكريم شوت -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
/* ========== أدوات وقت/سجل ========== */
const logEl = document.getElementById('log');
const statusPill = document.getElementById('statusPill');
const taskIdEl = document.getElementById('taskId');
const startedAtEl = document.getElementById('startedAt');
const shotCountEl = document.getElementById('shotCount');
let taskId = null, startedAt = null, running = false, autoTimer=null, shots=0;
let logStore = [];

function ts(){ return new Date().toLocaleString('ar-EG',{hour12:false}) }
function addLog(type,msg){
  const line = {t:Date.now(), ts:ts(), type, msg};
  logStore.push(line);
  const div=document.createElement('div');
  div.innerHTML = `<span class="mini mono" style="opacity:.7">${line.ts}</span> • <span class="pill">${type}</span> — ${escapeHTML(msg)}`;
  logEl.appendChild(div);
  logEl.scrollTop = logEl.scrollHeight;
}
function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}

/* ========== Canvas مشهد بسيط يتحرك (مكان الوكيل) ========== */
const canvas = document.getElementById('scene');
const ctx = canvas.getContext('2d');
function resize(){ canvas.width=canvas.clientWidth; canvas.height=canvas.clientHeight }
window.addEventListener('resize',resize); resize();

let t=0;
function draw(){
  t+=0.016;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // خلفية نجوم
  ctx.fillStyle = 'rgba(255,255,255,.03)';
  for(let i=0;i<120;i++){
    const x=(i*97+t*50)%canvas.width, y=(i*53+t*30)%canvas.height;
    ctx.fillRect(x,y,1,1);
  }
  // كرة سلكية
  const cx=canvas.width/2, cy=canvas.height/2, r=Math.min(cx,cy)*0.55;
  ctx.strokeStyle='rgba(0,255,255,.6)'; ctx.lineWidth=1;
  for(let i=0;i<18;i++){
    const a=t*0.6+i*0.35;
    ctx.beginPath();
    ctx.ellipse(cx,cy,r,r*(0.22+0.78*Math.abs(Math.sin(a))),0,a,Math.PI*2);
    ctx.stroke();
  }
  // نبض أسفل
  const w=180, h=6;
  ctx.fillStyle='rgba(255,0,255,.5)';
  ctx.fillRect(cx-w/2, cy+r+16, (w*(0.5+0.5*Math.sin(t*3))), h);
  requestAnimationFrame(draw);
}
draw();

/* ========== بدء/إيقاف المهمة + أوتوشوت ========== */
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const shotNowBtn=document.getElementById('shotNow');
const autoShotChk=document.getElementById('autoShot');
const shotEvery=document.getElementById('shotEvery');

startBtn.onclick=()=>{
  if(running) return;
  taskId = 'TASK-' + Math.random().toString(36).slice(2,8).toUpperCase();
  startedAt = ts();
  running = true; shots=0;
  taskIdEl.textContent=taskId; startedAtEl.textContent=startedAt; shotCountEl.textContent=0;
  statusPill.textContent='الحالة: يعمل'; statusPill.style.color='#0f0';
  addLog('START', `بدء المهمة: ${document.getElementById('taskName').value||'بدون اسم'} • الوكيل: ${document.getElementById('agentName').value}`);
  scheduleAuto();
};

stopBtn.onclick=()=>{
  if(!running) return;
  running=false;
  clearInterval(autoTimer);
  statusPill.textContent='الحالة: متوقف'; statusPill.style.color='#f66';
  addLog('STOP','تم إيقاف المهمة.');
};

function scheduleAuto(){
  clearInterval(autoTimer);
  if(!autoShotChk.checked) return;
  const s = Math.max(5, parseInt(shotEvery.value||20,10));
  autoTimer = setInterval(()=>captureShot('AUTO')), s*1000;
}

/* ========== سكرينشوت (canvas + الواجهة) ========== */
const gallery=document.getElementById('gallery');
async function captureShot(kind='MANUAL'){
  try{
    const node = document.querySelector('.wrap');
    const canvasShot = await html2canvas(node,{backgroundColor:null, scale:1});
    const data = canvasShot.toDataURL('image/png');
    const a = document.createElement('a'); a.href=data; a.download=`${taskId||'SHOT'}_${Date.now()}.png`;
    // a.click(); // لو حابب التحميل مباشرة فعّلها
    const card=document.createElement('div'); card.className='shot';
    card.innerHTML=`<img src="${data}"><div class="mini mono" style="padding:6px">${ts()} • ${kind}</div>`;
    gallery.prepend(card);
    shots++; shotCountEl.textContent=shots;
    addLog('SHOT', `تم التقاط لقطة (${kind}).`);
  }catch(e){
    addLog('ERROR','تعذر التقاط لقطة: '+e.message);
  }
}
shotNowBtn.onclick=()=>captureShot('MANUAL');
autoShotChk.onchange=()=>{ if(running) scheduleAuto(); }
shotEvery.onchange=()=>{ if(running) scheduleAuto(); }

/* ========== لوج: تصدير + علامة تقدّم ========== */
document.getElementById('exportLog').onclick=()=>{
  const blob = new Blob([JSON.stringify({taskId, startedAt, log:logStore},null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download=`${taskId||'LOG'}_${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
  addLog('EXPORT','تم تصدير اللوج كملف JSON.');
};
document.getElementById('markMilestone').onclick=()=>{
  addLog('MILESTONE','✔️ نقطة تقدّم تم تسجيلها.');
}

/* ========== اختصارات ========== */
document.addEventListener('keydown',e=>{
  if(e.key==='m' || e.key==='M') captureShot('HOTKEY');
  if(e.key==='l' || e.key==='L') document.getElementById('markMilestone').click();
});

/* ========== سوق الوكلاء: مولّد كوبي + إدراج + تصدير ========== */
const listings=[];
const market=document.getElementById('market');
document.getElementById('genCopy').onclick=()=>{
  const cat=document.getElementById('cat').value;
  const lang=document.getElementById('lang').value;
  const title=document.getElementById('title').value||'Agent-777';
  const feats=(document.getElementById('features').value||'').split('\n').filter(Boolean).slice(0,6);

  const lines=[
    `⚡ ${title} — وكيل ${labelCat(cat)} يعمل لحظيًا، مستقر وقابل للتخصيص.`,
    `• لغة التشغيل: ${labelLang(lang)} • التكامل: REST / Webhook / WhatsApp / Email.`,
    `• الاستخدام: تثبيت سريع + هوية صوت/شكل قابلة للتبديل.`,
    feats.length?`المزايا:\n- ${feats.join('\n- ')}`:'',
    `الترخيص يشمل تحديثات الأمان والدعم الأساسي.`,
    `ملاحظة: التشغيل يتم بدون تواصل بشري مباشر، كل شيء أوتوماتيكي بالكامل.`
  ].filter(Boolean).join('\n\n');

  document.getElementById('desc').value=lines;
};
function labelCat(c){
  return {
    support:'دعم فوري',
    sales:'مبيعات ذكي',
    content:'توليد محتوى',
    automation:'أتمتة',
    advisor:'استشاري'
  }[c]||c;
}
function labelLang(l){ return {ar:'عربية',en:'English',bi:'عربي/إنجليزي'}[l]||l }

document.getElementById('addListing').onclick=()=>{
  const item={
    id:'AG-'+Math.random().toString(36).slice(2,8).toUpperCase(),
    category:document.getElementById('cat').value,
    lang:document.getElementById('lang').value,
    title:document.getElementById('title').value||'Agent-777',
    price:document.getElementById('price').value||'On Request',
    features:(document.getElementById('features').value||'').split('\n').filter(Boolean),
    desc:document.getElementById('desc').value||'(سيتم التحديث)',
    createdAt:ts()
  };
  listings.unshift(item);
  renderMarket();
};
document.getElementById('exportListings').onclick=()=>{
  const blob = new Blob([JSON.stringify(listings,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download=`agents_market_${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
};

function renderMarket(){
  market.innerHTML='';
  for(const it of listings){
    const el=document.createElement('div'); el.className='item';
    el.innerHTML=`
      <h4>${escapeHTML(it.title)}</h4>
      <div class="mini">تصنيف: ${labelCat(it.category)} • لغة: ${labelLang(it.lang)} • <span class="mono">${it.id}</span></div>
      <div class="mini">السعر: <strong>${escapeHTML(it.price)}</strong></div>
      ${it.features?.length?`<div class="mini">مزايا:</div><ul style="margin:0 0 6px 0;padding-inline-start:18px">${it.features.slice(0,5).map(f=>`<li>${escapeHTML(f)}</li>`).join('')}</ul>`:''}
      <div class="mini" style="white-space:pre-wrap">${escapeHTML(it.desc).slice(0,400)}${it.desc.length>400?'…':''}</div>
      <div class="row"><button class="ghost" onclick='copyText(\`${escapeHTML(it.desc)}\`)'>نسخ الوصف</button></div>
    `;
    market.appendChild(el);
  }
}
function copyText(t){ navigator.clipboard.writeText(t); }

/* ========== تهيئة أولية ========== */
addLog('READY','النظام جاهز، يمكنك بدء المهمة، ووضع الأتوشوت لتوثيق الإنجاز.');

</script>
</body>
</html>
