<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AlArab 777 | ØºØ±ÙØ© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© + Ø³ÙˆÙ‚ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --c1:#00ffff; --c2:#ff00ff; --c3:#0af; --bg:#070b12; --panel:#0f1624;
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, rgba(255,0,255,.14), transparent 40%), radial-gradient(900px 500px at 0% 120%, rgba(0,255,255,.12), transparent 45%), var(--bg);color:#e9f8ff;font-family:"Cairo",system-ui}
  h2,h3{margin:8px 0 4px}
  .wrap{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:16px}
  .card{background:rgba(15,22,36,.9);border:1px solid rgba(0,255,255,.25);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  label{font-size:12px;opacity:.8}
  input,select,textarea{background:#0b1220;border:1px solid rgba(0,255,255,.25);color:#fff;border-radius:10px;padding:10px;font-family:inherit}
  textarea{width:100%;min-height:90px}
  button{background:linear-gradient(135deg,var(--c1),var(--c2));border:0;color:#000;font-weight:900;border-radius:10px;padding:10px 14px;cursor:pointer}
  button.ghost{background:transparent;color:#cfe; border:1px solid rgba(0,255,255,.3)}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);font-size:12px}
  .ok{color:#0f0}.bad{color:#f66}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .log{background:#060a14;border:1px dashed rgba(0,255,255,.25);border-radius:10px;padding:10px;height:220px;overflow:auto;font-size:13px;line-height:1.5}
  .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}
  .shot{border:1px solid rgba(0,255,255,.2);border-radius:10px;overflow:hidden;background:#000}
  .shot img{display:block;width:100%}
  .footer{padding:8px 16px;opacity:.6;text-align:center;font-size:12px}
  .badge{font-size:11px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);padding:4px 8px;border-radius:8px}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);margin:10px 0}
  .title{display:flex;justify-content:space-between;align-items:center}
  .title span{font-size:12px;opacity:.7}
  .market-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .item{background:#0c1322;border:1px solid rgba(0,255,255,.2);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px}
  .item h4{margin:0}
  .mini{font-size:12px;opacity:.75}
  canvas#scene{width:100%;height:240px;display:block;background:radial-gradient(circle at 50% 30%,rgba(0,255,255,.06),transparent 60%)}
  .kbd{padding:2px 6px;border:1px solid rgba(255,255,255,.2);border-radius:6px;background:rgba(255,255,255,.06);font-size:12px}
  @media (max-width:1024px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="wrap">

  <!-- ØºØ±ÙØ© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© / Ø§Ù„ÙˆÙƒÙŠÙ„ -->
  <section class="card">
    <div class="title">
      <h2>ğŸ›°ï¸ ØºØ±ÙØ© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© | ARA-777 Ops</h2>
      <span class="badge">Auto-Log â€¢ Auto-Screenshot</span>
    </div>

    <div class="grid2">
      <div>
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
        <input id="taskName" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ù†Ø§Ø¡ Ø³ÙƒØ´Ù† Ù‡Ø¨ÙˆØ· Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª">
      </div>
      <div>
        <label>Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ù†ÙÙ‘Ø°</label>
        <select id="agentName">
          <option>Farah-Creative</option>
          <option>Advisor-Dad</option>
          <option>Ops-Mom</option>
          <option>ARA-777 Core</option>
          <option>External-FastAgent</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:8px">
      <button id="startBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
      <button id="stopBtn" class="ghost">Ø¥ÙŠÙ‚Ø§Ù</button>
      <span class="pill" id="statusPill">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø²</span>
      <span class="pill mono">ID: <span id="taskId">â€”</span></span>
      <span class="pill mono">Ø¨Ø¯Ø£: <span id="startedAt">â€”</span></span>
      <span class="pill mono">Ù„Ù‚Ø·Ø§Øª: <span id="shotCount">0</span></span>
    </div>

    <div class="hr"></div>

    <div class="grid2">
      <div>
        <h3>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
        <div class="log" id="log"></div>
        <div class="row" style="margin-top:8px">
          <button id="exportLog">ØªØµØ¯ÙŠØ± Ø§Ù„Ù„ÙˆØ¬ (JSON)</button>
          <button id="markMilestone" class="ghost">âœ¨ Ø¹Ù„Ø§Ù…Ø© ØªÙ‚Ø¯Ù‘Ù…</button>
        </div>
      </div>
      <div>
        <h3>Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø­ÙŠ (Canvas)</h3>
        <canvas id="scene"></canvas>
        <div class="row" style="margin-top:8px">
          <button id="shotNow">ğŸ“¸ Ù„Ù‚Ø·Ø© Ø§Ù„Ø¢Ù†</button>
          <label><input type="checkbox" id="autoShot" checked> Ù„Ù‚Ø·Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ <input id="shotEvery" value="20" style="width:60px"> Ø«Ø§Ù†ÙŠØ©</label>
        </div>
      </div>
    </div>

    <h3 style="margin-top:12px">ğŸ“· Ø§Ù„Ù…Ø¹Ø±Ø¶</h3>
    <div class="gallery" id="gallery"></div>
  </section>

  <!-- Ø³ÙˆÙ‚ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ + Ø§Ù„Ù…ÙˆÙ„Ù‘Ø¯ -->
  <section class="card">
    <div class="title">
      <h2>ğŸ›’ Ø³ÙˆÙ‚ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ | Agent Marketplace</h2>
      <span class="badge">Ø¥Ø¯Ø±Ø§Ø¬ Ø³Ø±ÙŠØ¹ + Ù†Øµ Ø¬Ø§Ù‡Ø²</span>
    </div>

    <div class="grid2">
      <div>
        <label>ØªØµÙ†ÙŠÙ Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <select id="cat">
          <option value="support">Ø¯Ø¹Ù… ÙÙˆØ±ÙŠ (ØµÙˆØª/Ù†Øµ)</option>
          <option value="sales">Ù…Ø¨ÙŠØ¹Ø§Øª Ø°ÙƒÙŠ</option>
          <option value="content">Ù…ÙˆÙ„Ù‘Ø¯ Ù…Ø­ØªÙˆÙ‰/ØµÙˆØ±</option>
          <option value="automation">Ø£ØªÙ…ØªØ© Ù…ÙˆØ§Ù‚Ø¹/Ù…ØªØ§Ø¬Ø±</option>
          <option value="advisor">Ù…Ø³ØªØ´Ø§Ø± Ø£Ø¹Ù…Ø§Ù„</option>
        </select>
      </div>
      <div>
        <label>Ù„ØºØ© Ø§Ù„ØªØ´ØºÙŠÙ„</label>
        <select id="lang">
          <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="en">English</option>
          <option value="bi">Arabic + English</option>
        </select>
      </div>
    </div>

    <div class="grid2" style="margin-top:8px">
      <div>
        <label>Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <input id="title" placeholder="Ù…Ø«Ø§Ù„: Farah-Voice Concierge">
      </div>
      <div>
        <label>Ø³Ø¹Ø± Ø§Ù„ØªØ±Ø®ÙŠØµ</label>
        <input id="price" placeholder="$/Ø´Ù‡Ø±ÙŠ Ø£Ùˆ Ø¯ÙØ¹ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©">
      </div>
    </div>

    <label style="margin-top:8px">Ù…Ø²Ø§ÙŠØ§ Ø³Ø±ÙŠØ¹Ø© (Ø³Ø·Ø± Ù„ÙƒÙ„ Ù…ÙŠØ²Ø©)</label>
    <textarea id="features" placeholder="Ø±Ø¯ ØµÙˆØªÙŠ ÙÙˆØ±ÙŠ\nØªÙƒØ§Ù…Ù„ Ù…Ø¹ WhatsApp\nØªØ®ØµÙŠØµ Ù‡ÙˆÙŠØ© ØµÙˆØªÙŠØ©"></textarea>

    <label>ÙˆØµÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙŠÙÙˆÙ„Ø¯ Ù‡Ù†Ø§)</label>
    <textarea id="desc" placeholder="Ø§Ø¶ØºØ· ØªÙˆÙ„ÙŠØ¯ ğŸ‘‡"></textarea>

    <div class="row" style="margin-top:8px">
      <button id="genCopy">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¨ÙŠ</button>
      <button id="addListing" class="ghost">Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚</button>
      <button id="exportListings" class="ghost">ØªØµØ¯ÙŠØ± Ø§Ù„Ø³ÙˆÙ‚ (JSON)</button>
    </div>

    <div class="hr"></div>

    <h3>Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¯Ø±Ø¬Ø©</h3>
    <div class="market-list" id="market"></div>
  </section>

</div>

<div class="footer">â–°â–±â–° AlArab 777 Ops â€¢ Logging + AutoScreenshot + Marketplace â–°â–±â–° | Ø§Ø®ØªØµØ§Ø±: <span class="kbd">M</span> Ù„Ù‚Ø·Ø© â€¢ <span class="kbd">L</span> Ø¹Ù„Ø§Ù…Ø© ØªÙ‚Ø¯Ù‘Ù…</div>

<!-- html2canvas Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø³ÙƒØ±ÙŠÙ… Ø´ÙˆØª -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
/* ========== Ø£Ø¯ÙˆØ§Øª ÙˆÙ‚Øª/Ø³Ø¬Ù„ ========== */
const logEl = document.getElementById('log');
const statusPill = document.getElementById('statusPill');
const taskIdEl = document.getElementById('taskId');
const startedAtEl = document.getElementById('startedAt');
const shotCountEl = document.getElementById('shotCount');
let taskId = null, startedAt = null, running = false, autoTimer=null, shots=0;
let logStore = [];

function ts(){ return new Date().toLocaleString('ar-EG',{hour12:false}) }
function addLog(type,msg){
  const line = {t:Date.now(), ts:ts(), type, msg};
  logStore.push(line);
  const div=document.createElement('div');
  div.innerHTML = `<span class="mini mono" style="opacity:.7">${line.ts}</span> â€¢ <span class="pill">${type}</span> â€” ${escapeHTML(msg)}`;
  logEl.appendChild(div);
  logEl.scrollTop = logEl.scrollHeight;
}
function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}

/* ========== Canvas Ù…Ø´Ù‡Ø¯ Ø¨Ø³ÙŠØ· ÙŠØªØ­Ø±Ùƒ (Ù…ÙƒØ§Ù† Ø§Ù„ÙˆÙƒÙŠÙ„) ========== */
const canvas = document.getElementById('scene');
const ctx = canvas.getContext('2d');
function resize(){ canvas.width=canvas.clientWidth; canvas.height=canvas.clientHeight }
window.addEventListener('resize',resize); resize();

let t=0;
function draw(){
  t+=0.016;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Ø®Ù„ÙÙŠØ© Ù†Ø¬ÙˆÙ…
  ctx.fillStyle = 'rgba(255,255,255,.03)';
  for(let i=0;i<120;i++){
    const x=(i*97+t*50)%canvas.width, y=(i*53+t*30)%canvas.height;
    ctx.fillRect(x,y,1,1);
  }
  // ÙƒØ±Ø© Ø³Ù„ÙƒÙŠØ©
  const cx=canvas.width/2, cy=canvas.height/2, r=Math.min(cx,cy)*0.55;
  ctx.strokeStyle='rgba(0,255,255,.6)'; ctx.lineWidth=1;
  for(let i=0;i<18;i++){
    const a=t*0.6+i*0.35;
    ctx.beginPath();
    ctx.ellipse(cx,cy,r,r*(0.22+0.78*Math.abs(Math.sin(a))),0,a,Math.PI*2);
    ctx.stroke();
  }
  // Ù†Ø¨Ø¶ Ø£Ø³ÙÙ„
  const w=180, h=6;
  ctx.fillStyle='rgba(255,0,255,.5)';
  ctx.fillRect(cx-w/2, cy+r+16, (w*(0.5+0.5*Math.sin(t*3))), h);
  requestAnimationFrame(draw);
}
draw();

/* ========== Ø¨Ø¯Ø¡/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø© + Ø£ÙˆØªÙˆØ´ÙˆØª ========== */
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const shotNowBtn=document.getElementById('shotNow');
const autoShotChk=document.getElementById('autoShot');
const shotEvery=document.getElementById('shotEvery');

startBtn.onclick=()=>{
  if(running) return;
  taskId = 'TASK-' + Math.random().toString(36).slice(2,8).toUpperCase();
  startedAt = ts();
  running = true; shots=0;
  taskIdEl.textContent=taskId; startedAtEl.textContent=startedAt; shotCountEl.textContent=0;
  statusPill.textContent='Ø§Ù„Ø­Ø§Ù„Ø©: ÙŠØ¹Ù…Ù„'; statusPill.style.color='#0f0';
  addLog('START', `Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©: ${document.getElementById('taskName').value||'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'} â€¢ Ø§Ù„ÙˆÙƒÙŠÙ„: ${document.getElementById('agentName').value}`);
  scheduleAuto();
};

stopBtn.onclick=()=>{
  if(!running) return;
  running=false;
  clearInterval(autoTimer);
  statusPill.textContent='Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙ‚Ù'; statusPill.style.color='#f66';
  addLog('STOP','ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù‡Ù…Ø©.');
};

function scheduleAuto(){
  clearInterval(autoTimer);
  if(!autoShotChk.checked) return;
  const s = Math.max(5, parseInt(shotEvery.value||20,10));
  autoTimer = setInterval(()=>captureShot('AUTO')), s*1000;
}

/* ========== Ø³ÙƒØ±ÙŠÙ†Ø´ÙˆØª (canvas + Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©) ========== */
const gallery=document.getElementById('gallery');
async function captureShot(kind='MANUAL'){
  try{
    const node = document.querySelector('.wrap');
    const canvasShot = await html2canvas(node,{backgroundColor:null, scale:1});
    const data = canvasShot.toDataURL('image/png');
    const a = document.createElement('a'); a.href=data; a.download=`${taskId||'SHOT'}_${Date.now()}.png`;
    // a.click(); // Ù„Ùˆ Ø­Ø§Ø¨Ø¨ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© ÙØ¹Ù‘Ù„Ù‡Ø§
    const card=document.createElement('div'); card.className='shot';
    card.innerHTML=`<img src="${data}"><div class="mini mono" style="padding:6px">${ts()} â€¢ ${kind}</div>`;
    gallery.prepend(card);
    shots++; shotCountEl.textContent=shots;
    addLog('SHOT', `ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© (${kind}).`);
  }catch(e){
    addLog('ERROR','ØªØ¹Ø°Ø± Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø©: '+e.message);
  }
}
shotNowBtn.onclick=()=>captureShot('MANUAL');
autoShotChk.onchange=()=>{ if(running) scheduleAuto(); }
shotEvery.onchange=()=>{ if(running) scheduleAuto(); }

/* ========== Ù„ÙˆØ¬: ØªØµØ¯ÙŠØ± + Ø¹Ù„Ø§Ù…Ø© ØªÙ‚Ø¯Ù‘Ù… ========== */
document.getElementById('exportLog').onclick=()=>{
  const blob = new Blob([JSON.stringify({taskId, startedAt, log:logStore},null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download=`${taskId||'LOG'}_${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
  addLog('EXPORT','ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù„ÙˆØ¬ ÙƒÙ…Ù„Ù JSON.');
};
document.getElementById('markMilestone').onclick=()=>{
  addLog('MILESTONE','âœ”ï¸ Ù†Ù‚Ø·Ø© ØªÙ‚Ø¯Ù‘Ù… ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ø§.');
}

/* ========== Ø§Ø®ØªØµØ§Ø±Ø§Øª ========== */
document.addEventListener('keydown',e=>{
  if(e.key==='m' || e.key==='M') captureShot('HOTKEY');
  if(e.key==='l' || e.key==='L') document.getElementById('markMilestone').click();
});

/* ========== Ø³ÙˆÙ‚ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡: Ù…ÙˆÙ„Ù‘Ø¯ ÙƒÙˆØ¨ÙŠ + Ø¥Ø¯Ø±Ø§Ø¬ + ØªØµØ¯ÙŠØ± ========== */
const listings=[];
const market=document.getElementById('market');
document.getElementById('genCopy').onclick=()=>{
  const cat=document.getElementById('cat').value;
  const lang=document.getElementById('lang').value;
  const title=document.getElementById('title').value||'Agent-777';
  const feats=(document.getElementById('features').value||'').split('\n').filter(Boolean).slice(0,6);

  const lines=[
    `âš¡ ${title} â€” ÙˆÙƒÙŠÙ„ ${labelCat(cat)} ÙŠØ¹Ù…Ù„ Ù„Ø­Ø¸ÙŠÙ‹Ø§ØŒ Ù…Ø³ØªÙ‚Ø± ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ØªØ®ØµÙŠØµ.`,
    `â€¢ Ù„ØºØ© Ø§Ù„ØªØ´ØºÙŠÙ„: ${labelLang(lang)} â€¢ Ø§Ù„ØªÙƒØ§Ù…Ù„: REST / Webhook / WhatsApp / Email.`,
    `â€¢ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: ØªØ«Ø¨ÙŠØª Ø³Ø±ÙŠØ¹ + Ù‡ÙˆÙŠØ© ØµÙˆØª/Ø´ÙƒÙ„ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„.`,
    feats.length?`Ø§Ù„Ù…Ø²Ø§ÙŠØ§:\n- ${feats.join('\n- ')}`:'',
    `Ø§Ù„ØªØ±Ø®ÙŠØµ ÙŠØ´Ù…Ù„ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.`,
    `Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ØªØ´ØºÙŠÙ„ ÙŠØªÙ… Ø¨Ø¯ÙˆÙ† ØªÙˆØ§ØµÙ„ Ø¨Ø´Ø±ÙŠ Ù…Ø¨Ø§Ø´Ø±ØŒ ÙƒÙ„ Ø´ÙŠØ¡ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.`
  ].filter(Boolean).join('\n\n');

  document.getElementById('desc').value=lines;
};
function labelCat(c){
  return {
    support:'Ø¯Ø¹Ù… ÙÙˆØ±ÙŠ',
    sales:'Ù…Ø¨ÙŠØ¹Ø§Øª Ø°ÙƒÙŠ',
    content:'ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰',
    automation:'Ø£ØªÙ…ØªØ©',
    advisor:'Ø§Ø³ØªØ´Ø§Ø±ÙŠ'
  }[c]||c;
}
function labelLang(l){ return {ar:'Ø¹Ø±Ø¨ÙŠØ©',en:'English',bi:'Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ'}[l]||l }

document.getElementById('addListing').onclick=()=>{
  const item={
    id:'AG-'+Math.random().toString(36).slice(2,8).toUpperCase(),
    category:document.getElementById('cat').value,
    lang:document.getElementById('lang').value,
    title:document.getElementById('title').value||'Agent-777',
    price:document.getElementById('price').value||'On Request',
    features:(document.getElementById('features').value||'').split('\n').filter(Boolean),
    desc:document.getElementById('desc').value||'(Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«)',
    createdAt:ts()
  };
  listings.unshift(item);
  renderMarket();
};
document.getElementById('exportListings').onclick=()=>{
  const blob = new Blob([JSON.stringify(listings,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download=`agents_market_${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
};

function renderMarket(){
  market.innerHTML='';
  for(const it of listings){
    const el=document.createElement('div'); el.className='item';
    el.innerHTML=`
      <h4>${escapeHTML(it.title)}</h4>
      <div class="mini">ØªØµÙ†ÙŠÙ: ${labelCat(it.category)} â€¢ Ù„ØºØ©: ${labelLang(it.lang)} â€¢ <span class="mono">${it.id}</span></div>
      <div class="mini">Ø§Ù„Ø³Ø¹Ø±: <strong>${escapeHTML(it.price)}</strong></div>
      ${it.features?.length?`<div class="mini">Ù…Ø²Ø§ÙŠØ§:</div><ul style="margin:0 0 6px 0;padding-inline-start:18px">${it.features.slice(0,5).map(f=>`<li>${escapeHTML(f)}</li>`).join('')}</ul>`:''}
      <div class="mini" style="white-space:pre-wrap">${escapeHTML(it.desc).slice(0,400)}${it.desc.length>400?'â€¦':''}</div>
      <div class="row"><button class="ghost" onclick='copyText(\`${escapeHTML(it.desc)}\`)'>Ù†Ø³Ø® Ø§Ù„ÙˆØµÙ</button></div>
    `;
    market.appendChild(el);
  }
}
function copyText(t){ navigator.clipboard.writeText(t); }

/* ========== ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© ========== */
addLog('READY','Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŒ ÙˆÙˆØ¶Ø¹ Ø§Ù„Ø£ØªÙˆØ´ÙˆØª Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².');

</script>
</body>
</html>
