<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø±Ø§Ø¨ 777 Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙƒÙŠ - AlArab 777 Smart Text</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        .animate-fall { animation: fall linear infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, #f59e0b, #14b8a6); border-radius: 10px; }
        
        * { -webkit-tap-highlight-color: transparent; }
        
        [contenteditable] { outline: none; }
        [contenteditable] ul, [contenteditable] ol { margin: 8px 0; padding-right: 24px; }
        [contenteditable] li { margin: 4px 0; list-style-position: outside; }
        
        .glass-effect {
            background: rgba(17, 24, 39, 0.1);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-black overflow-x-hidden">
    <!-- Pharaonic Background -->
    <div class="absolute inset-0 opacity-5" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M30 0L45 15L30 30L15 15Z M30 30L45 45L30 60L15 45Z\' fill=\'%23FFD700\' fill-opacity=\'0.4\'/%3E%3C/svg%3E'); background-size: 60px 60px;"></div>
    
    <!-- Falling Hieroglyphs -->
    <div id="hieroglyphs" class="absolute inset-0 overflow-hidden pointer-events-none"></div>
    
    <!-- Glow Effects -->
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-amber-500/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-teal-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    
    <!-- Main App -->
    <div id="app" class="relative z-10 max-w-7xl mx-auto p-4 md:p-8"></div>
    
    <script>
        // Hieroglyphs Animation
        const hieroglyphsContainer = document.getElementById('hieroglyphs');
        const hieroglyphs = ['ğ“€€', 'ğ“€', 'ğ“€‚', 'ğ“€ƒ', 'ğ“€„', 'ğ“¹', 'ğ“‚€', 'ğ“ƒ€', 'ğ“†£'];
        for (let i = 0; i < 15; i++) {
            const div = document.createElement('div');
            div.className = 'absolute text-amber-500/20 text-2xl animate-fall';
            div.style.left = Math.random() * 100 + '%';
            div.style.animationDelay = Math.random() * 5 + 's';
            div.style.animationDuration = (10 + Math.random() * 10) + 's';
            div.textContent = hieroglyphs[Math.floor(Math.random() * hieroglyphs.length)];
            hieroglyphsContainer.appendChild(div);
        }
        
        // App State
        const state = {
            currentLanguage: 'ar',
            text: '',
            suggestions: [],
            isAnalyzing: false,
            isRecording: false,
            isSpeaking: false,
            error: '',
            aiProvider: 'ollama', // 'ollama' or 'api'
            ollamaModel: 'llama3',
            availableModels: []
        };
        
        const languages = [
            { code: 'ar', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
            { code: 'en', name: 'English', flag: 'ğŸ‡¬ğŸ‡§' },
            { code: 'fr', name: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·' },
            { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
            { code: 'de', name: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª' },
            { code: 'zh', name: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
            { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' }
        ];
        
        // Check Ollama and get models
        async function checkOllama() {
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                const data = await response.json();
                state.availableModels = data.models || [];
                if (state.availableModels.length > 0) {
                    state.ollamaModel = state.availableModels[0].name;
                    state.aiProvider = 'ollama';
                }
                return true;
            } catch (err) {
                console.log('Ollama not running, will use API');
                state.aiProvider = 'api';
                return false;
            }
        }
        
        // Analyze Text with Ollama or API
        async function analyzeText() {
            if (!state.text.trim()) {
                state.error = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ / Please enter text';
                render();
                return;
            }
            
            state.isAnalyzing = true;
            state.error = '';
            state.suggestions = [];
            render();
            
            try {
                if (state.aiProvider === 'ollama' && state.availableModels.length > 0) {
                    await analyzeWithOllama();
                } else {
                    await analyzeWithAPI();
                }
            } catch (err) {
                console.error('Analysis error:', err);
                state.error = 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ / Analysis failed';
            } finally {
                state.isAnalyzing = false;
                render();
            }
        }
        
        // Analyze with Ollama (Local)
        async function analyzeWithOllama() {
            const prompt = `Analyze this ${state.currentLanguage} text and provide suggestions as JSON array.
Each suggestion needs: category (grammar/spelling/punctuation/style/clarity), issue, suggestion, explanation.
Text: "${state.text}"
Return ONLY valid JSON array, nothing else.`;
            
            const response = await fetch('http://localhost:11434/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: state.ollamaModel,
                    prompt: prompt,
                    stream: false
                })
            });
            
            const data = await response.json();
            const text = data.response;
            const jsonMatch = text.match(/\[[\s\S]*\]/);
            
            if (jsonMatch) {
                const suggestions = JSON.parse(jsonMatch[0]);
                state.suggestions = Array.isArray(suggestions) ? suggestions : [];
            }
        }
        
        // Analyze with Claude API (Fallback)
        async function analyzeWithAPI() {
            const prompt = `Analyze this ${state.currentLanguage} text: "${state.text}"
Return JSON array with suggestions. Format: [{category, issue, suggestion, explanation}]
ONLY JSON array, nothing else.`;
            
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: 4000,
                    messages: [{ role: "user", content: prompt }]
                })
            });
            
            const data = await response.json();
            const content = data.content[0].text;
            const jsonMatch = content.match(/\[[\s\S]*\]/);
            
            if (jsonMatch) {
                const suggestions = JSON.parse(jsonMatch[0]);
                state.suggestions = Array.isArray(suggestions) ? suggestions : [];
            }
        }
        
        // Speech-to-Text
        let recognition;
        function startRecording() {
            if (!('webkitSpeechRecognition' in window)) {
                state.error = 'Ø§Ø³ØªØ®Ø¯Ù… Chrome / Use Chrome';
                render();
                return;
            }
            
            const SpeechRecognition = window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = state.currentLanguage === 'ar' ? 'ar-SA' : 'en-US';
            recognition.continuous = true;
            
            recognition.onstart = () => {
                state.isRecording = true;
                render();
            };
            
            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        transcript += event.results[i][0].transcript + ' ';
                    }
                }
                if (transcript) {
                    state.text += transcript;
                    document.getElementById('editor').innerHTML += `<div>${transcript}</div>`;
                }
            };
            
            recognition.onerror = () => {
                state.isRecording = false;
                render();
            };
            
            recognition.start();
        }
        
        function stopRecording() {
            if (recognition) {
                recognition.stop();
                state.isRecording = false;
                render();
            }
        }
        
        // Text-to-Speech
        function speakText() {
            if (!state.text.trim()) return;
            
            if (state.isSpeaking) {
                window.speechSynthesis.cancel();
                state.isSpeaking = false;
                render();
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(state.text);
            utterance.lang = state.currentLanguage === 'ar' ? 'ar-SA' : 'en-US';
            utterance.onstart = () => { state.isSpeaking = true; render(); };
            utterance.onend = () => { state.isSpeaking = false; render(); };
            window.speechSynthesis.speak(utterance);
        }
        
        // Render UI
        function render() {
            const isRTL = state.currentLanguage === 'ar';
            const t = state.currentLanguage === 'ar' ? {
                title: 'Ø§Ù„Ø¹Ø±Ø§Ø¨ 777 Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙƒÙŠ',
                analyze: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ',
                recording: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...',
                startRec: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„',
                speak: 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù†Øµ',
                provider: 'Ø§Ù„Ù…Ø²ÙˆØ¯',
                model: 'Ø§Ù„Ù†Ù…ÙˆØ°Ø¬'
            } : {
                title: 'AlArab 777 Smart Text',
                analyze: 'Analyze',
                recording: 'Recording...',
                startRec: 'Record',
                speak: 'Speak',
                provider: 'Provider',
                model: 'Model'
            };
            
            document.getElementById('app').innerHTML = `
                <!-- Header -->
                <div class="flex justify-between items-center mb-8 ${isRTL ? 'flex-row-reverse' : ''}">
                    <div class="flex items-center gap-4 ${isRTL ? 'flex-row-reverse' : ''}">
                        <div class="relative">
                            <div class="absolute inset-0 bg-gradient-to-r from-amber-500 to-teal-500 rounded-xl blur-lg opacity-50 animate-pulse"></div>
                            <div class="relative bg-gradient-to-br from-amber-500 via-yellow-500 to-teal-500 p-3 rounded-xl shadow-2xl">
                                <svg class="w-8 h-8 text-gray-900" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            </div>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold bg-gradient-to-r from-amber-400 via-yellow-300 to-teal-400 bg-clip-text text-transparent">${t.title}</h1>
                            <p class="text-sm bg-gradient-to-r from-amber-300/70 to-teal-300/70 bg-clip-text text-transparent">AlArab Club 777 - Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠ</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <select onchange="state.currentLanguage=this.value; render()" class="px-3 py-2 rounded-lg bg-gray-900/70 backdrop-blur-md border border-amber-500/30 text-amber-300 text-2xl">
                            ${languages.map(l => `<option value="${l.code}" ${state.currentLanguage === l.code ? 'selected' : ''}>${l.flag}</option>`).join('')}
                        </select>
                    </div>
                </div>
                
                <!-- AI Provider Selection -->
                <div class="mb-4 p-4 rounded-xl glass-effect border border-amber-500/20">
                    <div class="flex gap-4 items-center ${isRTL ? 'flex-row-reverse' : ''}">
                        <label class="text-amber-400">${t.provider}:</label>
                        <select onchange="state.aiProvider=this.value; render()" class="px-3 py-1 rounded bg-gray-800/80 border border-amber-500/30 text-amber-300">
                            <option value="ollama" ${state.aiProvider === 'ollama' ? 'selected' : ''}>Ollama (Local)</option>
                            <option value="api" ${state.aiProvider === 'api' ? 'selected' : ''}>Claude API</option>
                        </select>
                        
                        ${state.aiProvider === 'ollama' && state.availableModels.length > 0 ? `
                            <label class="text-teal-400">${t.model}:</label>
                            <select onchange="state.ollamaModel=this.value" class="px-3 py-1 rounded bg-gray-800/80 border border-teal-500/30 text-teal-300">
                                ${state.availableModels.map(m => `<option value="${m.name}" ${state.ollamaModel === m.name ? 'selected' : ''}>${m.name}</option>`).join('')}
                            </select>
                        ` : ''}
                        
                        ${state.aiProvider === 'ollama' && state.availableModels.length === 0 ? '<span class="text-red-400">Ollama not running</span>' : ''}
                    </div>
                </div>
                
                <!-- Editor -->
                <div class="rounded-2xl shadow-2xl p-6 glass-effect border border-amber-500/20 mb-6">
                    <div class="flex justify-between items-center mb-4 gap-2 ${isRTL ? 'flex-row-reverse' : ''}">
                        <button onclick="${state.isRecording ? 'stopRecording()' : 'startRecording()'}" 
                            class="px-4 py-2 rounded-lg ${state.isRecording ? 'bg-red-500/20 border-red-500/50 text-red-300 animate-pulse' : 'bg-gray-800/80 border-amber-500/30 text-amber-300'} border backdrop-blur-sm">
                            ${state.isRecording ? 'ğŸ›‘ ' + t.recording : 'ğŸ¤ ' + t.startRec}
                        </button>
                        
                        <button onclick="speakText()" 
                            class="px-4 py-2 rounded-lg ${state.isSpeaking ? 'bg-green-500/20 border-green-500/50 text-green-300 animate-pulse' : 'bg-gray-800/80 border-teal-500/30 text-teal-300'} border backdrop-blur-sm">
                            ${state.isSpeaking ? 'ğŸ›‘' : 'ğŸ”Š'} ${t.speak}
                        </button>
                        
                        <button onclick="analyzeText()" 
                            ${state.isAnalyzing ? 'disabled' : ''}
                            class="px-6 py-2 rounded-lg bg-gradient-to-r from-amber-500 via-yellow-500 to-teal-500 text-gray-900 font-bold hover:shadow-2xl hover:shadow-amber-500/50 transition-all">
                            ${state.isAnalyzing ? 'â³ Ø¬Ø§Ø±ÙŠ...' : 'âš¡ ' + t.analyze}
                        </button>
                    </div>
                    
                    <div id="editor" contenteditable="true" 
                        oninput="state.text=this.innerText"
                        class="w-full min-h-96 p-4 rounded-xl border border-amber-500/20 bg-gray-950/20 backdrop-blur-md text-amber-50 overflow-y-auto focus:outline-none focus:border-amber-500/50"
                        style="direction: ${isRTL ? 'rtl' : 'ltr'}; text-align: ${isRTL ? 'right' : 'left'}; font-size: 16px; line-height: 1.6;"></div>
                    
                    ${state.error ? `<div class="mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400">${state.error}</div>` : ''}
                </div>
                
                <!-- Suggestions -->
                <div class="rounded-2xl shadow-2xl p-6 glass-effect border border-teal-500/20">
                    <h2 class="text-xl font-semibold mb-4 bg-gradient-to-r from-teal-400 to-amber-400 bg-clip-text text-transparent">
                        Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª (${state.suggestions.length})
                    </h2>
                    <div class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                        ${state.suggestions.length === 0 
                            ? '<p class="text-center text-amber-400/50 py-12">Ø§Ø¶ØºØ· "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ" Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</p>'
                            : state.suggestions.map((s, i) => `
                                <div class="p-4 rounded-xl bg-gray-950/40 border border-amber-500/20">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="px-3 py-1 rounded-full text-xs font-bold text-gray-900 bg-gradient-to-r from-amber-500 to-yellow-600">${s.category}</span>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="flex items-center gap-2 text-sm">
                                            <span class="line-through text-red-400">${s.issue}</span>
                                            <span class="text-amber-400">â†’</span>
                                            <span class="font-bold text-green-400">${s.suggestion}</span>
                                        </div>
                                        <p class="text-sm text-amber-200/80">${s.explanation}</p>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="mt-8 text-center">
                    <p class="text-sm bg-gradient-to-r from-amber-400 via-yellow-300 to-teal-400 bg-clip-text text-transparent font-semibold">
                        âœ¨ Powered by AlArab Club 777 - Smart Writing for Everyone âœ¨
                    </p>
                </div>
            `;
        }
        
        // Initialize
        checkOllama().then(() => render());
    </script>
</body>
</html>